<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>TableFinder Pro — Staff Panel</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@500;700&family=Playfair+Display:wght@600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0a0b0f;
            --surface: #12141a;
            --surface-2: #1a1c24;
            --surface-3: #22252e;
            --border: #2a2d38;
            --border-light: #363a48;
            --text: #f0f0f3;
            --text-dim: #8b8d98;
            --text-muted: #55576a;
            --accent: #6366f1;
            --accent-light: #818cf8;
            --accent-glow: rgba(99,102,241,.2);
            --green: #22c55e;
            --green-dim: rgba(34,197,94,.1);
            --green-border: rgba(34,197,94,.25);
            --red: #ef4444;
            --red-dim: rgba(239,68,68,.08);
            --red-border: rgba(239,68,68,.25);
            --yellow: #eab308;
            --radius: 16px;
            --radius-sm: 10px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'DM Sans', -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            -webkit-tap-highlight-color: transparent;
        }

        /* TOP BAR */
        .topbar {
            position: sticky; top: 0; z-index: 100;
            display: flex; align-items: center; justify-content: space-between;
            padding: 18px 28px;
            background: rgba(10,11,15,.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
        }
        .topbar-brand {
            display: flex; align-items: center; gap: 14px;
        }
        .topbar-brand .icon {
            width: 42px; height: 42px;
            background: linear-gradient(135deg, var(--accent), #a855f7);
            border-radius: 12px;
            display: grid; place-items: center;
            font-size: 20px;
            box-shadow: 0 4px 20px rgba(99,102,241,.3);
        }
        .topbar-brand h1 {
            font-family: 'Playfair Display', serif;
            font-size: 20px; font-weight: 800;
            letter-spacing: -.5px;
        }
        .topbar-brand h1 span { color: var(--accent-light); }
        .topbar-brand small {
            display: block; font-size: 11px;
            color: var(--text-dim); font-weight: 500;
            text-transform: uppercase; letter-spacing: 1.5px;
        }

        .topbar-center {
            display: flex; align-items: center; gap: 14px;
        }
        .live-dot {
            width: 8px; height: 8px;
            background: var(--green);
            border-radius: 50%;
            box-shadow: 0 0 8px var(--green);
            animation: blink 2s ease infinite;
        }
        @keyframes blink { 0%,100%{opacity:1} 50%{opacity:.3} }
        .clock-display {
            font-size: 13px; color: var(--text-dim); font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        .topbar-actions { display: flex; gap: 10px; }
        .topbar-actions button, .topbar-actions a {
            padding: 9px 18px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text-dim);
            font-family: inherit;
            font-size: 13px; font-weight: 600;
            cursor: pointer;
            transition: all .2s;
            text-decoration: none;
            display: inline-flex; align-items: center; gap: 6px;
        }
        .topbar-actions button:hover, .topbar-actions a:hover {
            border-color: var(--accent);
            color: var(--text);
            background: var(--accent-glow);
        }
        .topbar-actions button.danger:hover {
            border-color: var(--red);
            color: var(--red);
            background: var(--red-dim);
        }

        /* VENUE TABS */
        .venue-tabs {
            display: flex; gap: 8px;
            padding: 20px 28px 0;
            overflow-x: auto;
        }
        .venue-tab {
            padding: 12px 22px;
            border-radius: 12px 12px 0 0;
            border: 1px solid var(--border);
            border-bottom: none;
            background: var(--surface);
            color: var(--text-dim);
            font-family: inherit;
            font-size: 14px; font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: all .2s;
        }
        .venue-tab.active {
            background: var(--surface-2);
            color: var(--text);
            border-color: var(--accent);
        }
        .venue-tab .tab-count {
            display: inline-block;
            margin-left: 10px;
            padding: 3px 10px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        .venue-tab .tab-count.ok { background: var(--green-dim); color: var(--green); }
        .venue-tab .tab-count.full { background: var(--red-dim); color: var(--red); }

        /* STATS BAR */
        .stats-bar {
            display: flex; gap: 14px;
            padding: 24px 28px;
            flex-wrap: wrap;
        }
        .stat-card {
            flex: 1; min-width: 150px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px 22px;
            transition: all .2s;
        }
        .stat-card:hover {
            border-color: var(--border-light);
            transform: translateY(-1px);
        }
        .stat-card .label {
            font-size: 11px; font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        .stat-card .value {
            font-size: 32px; font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
            letter-spacing: -1px;
        }
        .stat-card .value.green { color: var(--green); }
        .stat-card .value.red { color: var(--red); }
        .stat-card .value.yellow { color: var(--yellow); }

        .occupancy-bar {
            margin-top: 12px; height: 6px;
            background: var(--surface-2);
            border-radius: 3px; overflow: hidden;
        }
        .occupancy-bar .fill {
            height: 100%;
            border-radius: 3px;
            transition: width .4s ease;
        }

        /* BULK ACTIONS */
        .bulk-actions {
            display: flex; gap: 10px;
            padding: 0 28px 20px;
            flex-wrap: wrap;
        }
        .bulk-btn {
            padding: 11px 22px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text);
            font-family: inherit;
            font-size: 13px; font-weight: 600;
            cursor: pointer;
            transition: all .2s;
            display: flex; align-items: center; gap: 8px;
        }
        .bulk-btn:hover { border-color: var(--accent); transform: translateY(-1px); }
        .bulk-btn.green-action:hover { border-color: var(--green); background: var(--green-dim); }
        .bulk-btn.red-action:hover { border-color: var(--red); background: var(--red-dim); }

        /* TABLE GRID */
        .section-label {
            padding: 0 28px 14px;
            font-size: 12px; font-weight: 700;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .table-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 14px;
            padding: 0 28px 36px;
        }

        .table-card {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            padding: 22px 18px;
            cursor: pointer;
            transition: all .2s cubic-bezier(.4,0,.2,1);
            text-align: center;
            user-select: none;
            position: relative;
            overflow: hidden;
        }
        .table-card::before {
            content: '';
            position: absolute; top: 0; left: 0; right: 0;
            height: 4px;
            transition: .2s;
        }
        .table-card.empty { border-color: var(--green-border); }
        .table-card.empty::before { background: var(--green); }
        .table-card.occupied { border-color: var(--red-border); }
        .table-card.occupied::before { background: var(--red); }

        .table-card:active { transform: scale(.96); }
        .table-card:hover {
            border-color: var(--accent);
            box-shadow: 0 0 24px var(--accent-glow);
            transform: translateY(-2px);
        }

        .table-card .table-number {
            font-size: 26px; font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
            margin-bottom: 8px;
        }
        .table-card.empty .table-number { color: var(--green); }
        .table-card.occupied .table-number { color: var(--red); }

        .table-card .table-status {
            font-size: 11px; font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            padding: 5px 12px;
            border-radius: 6px;
            display: inline-block;
        }
        .table-card.empty .table-status { background: var(--green-dim); color: var(--green); }
        .table-card.occupied .table-status { background: var(--red-dim); color: var(--red); }

        .table-card .table-meta {
            font-size: 12px;
            color: var(--text-dim);
            line-height: 1.8;
        }

        .table-card .tap-hint {
            margin-top: 14px;
            font-size: 10px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* TOAST */
        .toast-container {
            position: fixed; bottom: 28px; right: 28px;
            z-index: 200; display: flex; flex-direction: column; gap: 10px;
        }
        .toast {
            padding: 14px 22px;
            background: var(--surface-2);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 13px; font-weight: 600;
            color: var(--text);
            display: flex; align-items: center; gap: 10px;
            box-shadow: 0 8px 32px rgba(0,0,0,.4);
        }

        /* FOOTER */
        .admin-footer {
            padding: 24px 28px;
            border-top: 1px solid var(--border);
            font-size: 12px;
            color: var(--text-muted);
            text-align: center;
        }
        .admin-footer a {
            color: var(--accent-light);
            text-decoration: none;
        }

        @media (max-width: 600px) {
            .topbar { padding: 14px 18px; flex-wrap: wrap; gap: 10px; }
            .topbar-center { order: 3; width: 100%; justify-content: center; }
            .stats-bar { padding: 14px 18px; }
            .table-grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); padding: 0 18px 28px; gap: 10px; }
            .bulk-actions { padding: 0 18px 14px; }
            .section-label { padding: 0 18px 12px; }
            .venue-tabs { padding: 14px 18px 0; }
        }
    </style>
</head>
<body>

    <!-- TOP BAR -->
    <div class="topbar">
        <div class="topbar-brand">
            <div class="icon">&#x1F37D;&#xFE0F;</div>
            <div>
                <h1>Table<span>Finder</span> Pro</h1>
                <small>Staff Control Panel</small>
            </div>
        </div>
        <div class="topbar-center">
            <div class="live-dot"></div>
            <span class="clock-display" id="clock"></span>
        </div>
        <div class="topbar-actions">
            <a href="index.html" target="_blank">Customer View</a>
            <button class="danger" onclick="resetAll()">Reset All</button>
        </div>
    </div>

    <!-- VENUE TABS -->
    <div class="venue-tabs" id="venueTabs"></div>

    <!-- STATS -->
    <div class="stats-bar" id="statsBar"></div>

    <!-- BULK ACTIONS -->
    <div class="bulk-actions">
        <button class="bulk-btn green-action" onclick="setAll('empty')">Mark All Empty</button>
        <button class="bulk-btn red-action" onclick="setAll('occupied')">Mark All Occupied</button>
        <button class="bulk-btn" onclick="toggleIndoor()">Toggle Indoor</button>
        <button class="bulk-btn" onclick="toggleOutdoor()">Toggle Outdoor</button>
    </div>

    <!-- TABLE GRIDS -->
    <div class="section-label" id="indoorLabel">Indoor Tables</div>
    <div class="table-grid" id="indoorGrid"></div>

    <div class="section-label" id="outdoorLabel">Outdoor Tables</div>
    <div class="table-grid" id="outdoorGrid"></div>

    <!-- TOAST -->
    <div class="toast-container" id="toasts"></div>

    <!-- FOOTER -->
    <div class="admin-footer">
        TableFinder Pro v2.0 &middot; Tap any table to toggle status &middot; Changes sync live to <a href="index.html">customer view</a>
    </div>

    <script src="js/data.js"></script>
    <script>
        let activeVenueId = 1;

        // ---- CLOCK ----
        function updateClock() {
            document.getElementById('clock').textContent =
                new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        }
        setInterval(updateClock, 1000);
        updateClock();

        // ---- RENDER ----
        function render() {
            const venues = TF.loadVenues();
            const venue = venues.find(v => v.id === activeVenueId);
            if (!venue) return;

            // Tabs
            document.getElementById('venueTabs').innerHTML = venues.map(v => {
                const s = TF.getStats(v);
                const isActive = v.id === activeVenueId;
                return `<button class="venue-tab ${isActive ? 'active' : ''}" onclick="switchVenue(${v.id})">
                    ${v.name}
                    <span class="tab-count ${s.empty > 0 ? 'ok' : 'full'}">${s.empty}/${s.total}</span>
                </button>`;
            }).join('');

            // Stats
            const stats = TF.getStats(venue);
            const barColor = stats.rate > 80 ? 'var(--red)' : stats.rate > 50 ? 'var(--yellow)' : 'var(--green)';
            document.getElementById('statsBar').innerHTML = `
                <div class="stat-card">
                    <div class="label">Available</div>
                    <div class="value green">${stats.empty}</div>
                </div>
                <div class="stat-card">
                    <div class="label">Occupied</div>
                    <div class="value red">${stats.occupied}</div>
                </div>
                <div class="stat-card">
                    <div class="label">Total</div>
                    <div class="value">${stats.total}</div>
                </div>
                <div class="stat-card">
                    <div class="label">Occupancy</div>
                    <div class="value yellow">${stats.rate}%</div>
                    <div class="occupancy-bar">
                        <div class="fill" style="width:${stats.rate}%;background:${barColor}"></div>
                    </div>
                </div>
            `;

            // Tables
            const indoor = venue.tables.filter(t => t.location === 'indoor');
            const outdoor = venue.tables.filter(t => t.location === 'outdoor');

            document.getElementById('indoorLabel').textContent = 'INDOOR TABLES (' + indoor.length + ')';
            document.getElementById('outdoorLabel').textContent = 'OUTDOOR TABLES (' + outdoor.length + ')';

            document.getElementById('indoorGrid').innerHTML = indoor.map(t => tableCard(venue.id, t)).join('');
            document.getElementById('outdoorGrid').innerHTML = outdoor.map(t => tableCard(venue.id, t)).join('');
        }

        function tableCard(venueId, t) {
            return `<div class="table-card ${t.status}" onclick="toggle(${venueId},${t.id})">
                <div class="table-number">#${t.id}</div>
                <div class="table-status">${t.status}</div>
                <div class="table-meta">
                    ${t.seats} seats
                    ${t.smoking ? ' &middot; Smoking' : ''}
                    ${t.hasWindow ? ' &middot; Window' : ''}
                    <br>${t.serverName}
                </div>
                <div class="tap-hint">tap to toggle</div>
            </div>`;
        }

        // ---- ACTIONS ----
        function toggle(venueId, tableId) {
            TF.toggleTable(venueId, tableId);
            const venues = TF.loadVenues();
            const table = venues.find(v => v.id === venueId)?.tables.find(t => t.id === tableId);
            showToast('Table #' + tableId + ' → ' + (table?.status === 'empty' ? 'Empty' : 'Occupied'));
            render();

            // GSAP pulse on the toggled card
            const cards = document.querySelectorAll('.table-card');
            cards.forEach(c => {
                if (c.querySelector('.table-number')?.textContent === '#' + tableId) {
                    gsap.fromTo(c, { scale: 0.95 }, { scale: 1, duration: 0.3, ease: 'back.out(2)' });
                }
            });
        }

        function switchVenue(id) {
            activeVenueId = id;
            render();
            // Animate cards in
            gsap.from('.table-card', { y: 15, opacity: 0, duration: 0.3, stagger: 0.03, ease: 'power3.out' });
            gsap.from('.stat-card', { y: -10, opacity: 0, duration: 0.3, stagger: 0.05, ease: 'power3.out' });
        }

        function setAll(status) {
            TF.setAllTables(activeVenueId, status);
            showToast('All tables marked ' + (status === 'empty' ? 'empty' : 'occupied'));
            render();
            gsap.from('.table-card', { scale: 0.9, opacity: 0, duration: 0.3, stagger: 0.02, ease: 'back.out(1.5)' });
        }

        function toggleIndoor() {
            const venues = TF.loadVenues();
            const venue = venues.find(v => v.id === activeVenueId);
            venue.tables.filter(t => t.location === 'indoor').forEach(t => {
                t.status = t.status === 'empty' ? 'occupied' : 'empty';
            });
            TF.saveVenues(venues);
            showToast('Indoor tables toggled');
            render();
        }

        function toggleOutdoor() {
            const venues = TF.loadVenues();
            const venue = venues.find(v => v.id === activeVenueId);
            venue.tables.filter(t => t.location === 'outdoor').forEach(t => {
                t.status = t.status === 'empty' ? 'occupied' : 'empty';
            });
            TF.saveVenues(venues);
            showToast('Outdoor tables toggled');
            render();
        }

        function resetAll() {
            if (confirm('Reset all venues to defaults?')) {
                TF.resetVenues();
                showToast('All venues reset to defaults');
                render();
            }
        }

        // ---- TOAST (GSAP animated) ----
        function showToast(msg) {
            const el = document.createElement('div');
            el.className = 'toast';
            el.innerHTML = '<span>' + msg + '</span>';
            document.getElementById('toasts').appendChild(el);
            gsap.fromTo(el,
                { opacity: 0, y: 20, scale: 0.95 },
                { opacity: 1, y: 0, scale: 1, duration: 0.3, ease: 'back.out(1.5)' }
            );
            setTimeout(() => {
                gsap.to(el, { opacity: 0, y: -10, duration: 0.25, onComplete: () => el.remove() });
            }, 2200);
        }

        // ---- CROSS-TAB SYNC ----
        TF.channel.onmessage = () => render();

        // ---- INIT ----
        if (!localStorage.getItem(TF.STORAGE_KEY)) {
            TF.saveVenues(JSON.parse(JSON.stringify(TF.DEFAULT_VENUES)));
        }
        render();

        // Entrance animation
        gsap.from('.topbar', { y: -30, opacity: 0, duration: 0.4, ease: 'power3.out' });
        gsap.from('.venue-tab', { y: 15, opacity: 0, duration: 0.3, stagger: 0.05, ease: 'power3.out', delay: 0.2 });
        gsap.from('.stat-card', { y: 20, opacity: 0, duration: 0.35, stagger: 0.06, ease: 'power3.out', delay: 0.3 });
        gsap.from('.bulk-btn', { x: -15, opacity: 0, duration: 0.3, stagger: 0.04, ease: 'power3.out', delay: 0.4 });
        gsap.from('.table-card', { y: 20, opacity: 0, duration: 0.3, stagger: 0.025, ease: 'power3.out', delay: 0.5 });
    </script>
</body>
</html>
